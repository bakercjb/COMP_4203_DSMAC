# COMP_4203_DSMAC
## Simulation visualization module
### System requirements
- OMNeT (installed following the instructions)
- Castalia (installed following the instructions)
- gnuplot
- python3
### Python requirements
#### packages in environment at /home/user/anaconda3/envs/projCode:
####
#### Name                    Version                   Build  Channel
- alabaster                 0.7.10           py36h306e16b_0  
- asn1crypto                0.24.0                   py36_0  
- astroid                   1.6.2                    py36_0  
- babel                     2.5.3                    py36_0  
- bleach                    2.1.3                    py36_0  
- ca-certificates           2017.08.26           h1d4fec5_0  
- certifi                   2018.1.18                py36_0  
- cffi                      1.11.5           py36h9745a5d_0  
- chardet                   3.0.4            py36h0f667ec_1  
- cloudpickle               0.5.2                    py36_1  
- cryptography              2.2.1            py36h14c3975_0  
- dbus                      1.12.2               hc3f9b76_1  
- decorator                 4.2.1                    py36_0  
- docutils                  0.14             py36hb0f60f5_0  
- entrypoints               0.2.3            py36h1aec115_2  
- expat                     2.2.5                he0dffb1_0  
- fontconfig                2.12.6               h49f89f6_0  
- freetype                  2.8                  hab7d2ae_1  
- glib                      2.53.6               h5d9569c_2  
- gmp                       6.1.2                h6c8ec71_1  
- gst-plugins-base          1.12.4               h33fb286_0  
- gstreamer                 1.12.4               hb53b477_0  
- html5lib                  1.0.1            py36h2f9c1c0_0  
- icu                       58.2                 h9c2bf20_1  
- idna                      2.6              py36h82fb2a8_1  
- imagesize                 1.0.0                    py36_0  
- ipykernel                 4.8.2                    py36_0  
- ipython                   6.2.1            py36h88c514a_1  
- ipython_genutils          0.2.0            py36hb52b0d5_0  
- isort                     4.3.4                    py36_0  
- jedi                      0.11.1                   py36_1  
- jinja2                    2.10             py36ha16c418_0  
- jpeg                      9b                   h024ee3a_2  
- jsonschema                2.6.0            py36h006f8b5_0  
- jupyter_client            5.2.3                    py36_0  
- jupyter_core              4.4.0            py36h7c827e3_0  
- lazy-object-proxy         1.3.1            py36h10fcdad_0  
- libedit                   3.1                  heed3624_0  
- libffi                    3.2.1                hd88cf55_4  
- libgcc-ng                 7.2.0                hdf63c60_3  
- libpng                    1.6.34               hb9fc6fc_0  
- libsodium                 1.0.15               hf101ebd_0  
- libstdcxx-ng              7.2.0                hdf63c60_3  
- libxcb                    1.12                 hcd93eb1_4  
- libxml2                   2.9.7                h26e45fe_0  
- markupsafe                1.0              py36hd9260cd_1  
- mccabe                    0.6.1            py36h5ad9710_1  
- mistune                   0.8.3                    py36_0  
- nbconvert                 5.3.1            py36hb41ffb7_0  
- nbformat                  4.4.0            py36h31c9010_0  
- ncurses                   6.0                  h9df7e31_2  
- numpydoc                  0.7.0            py36h18f165f_0  
- openssl                   1.0.2n               hb7f436b_0  
- packaging                 17.1                     py36_0  
- pandoc                    1.19.2.1             hea2e7c5_1  
- pandocfilters             1.4.2            py36ha6701b7_1  
- parso                     0.1.1            py36h35f843b_0  
- pcre                      8.41                 hc27e229_1  
- pexpect                   4.4.0                    py36_0  
- pickleshare               0.7.4            py36h63277f8_0  
- pip                       9.0.1                    py36_5  
- pip                       9.0.3                     <pip>
- prompt_toolkit            1.0.15           py36h17d85b1_0  
- psutil                    5.4.3            py36h14c3975_0  
- ptyprocess                0.5.2            py36h69acd42_0  
- pycodestyle               2.3.1            py36hf609f19_0  
- pycparser                 2.18             py36hf9f622e_1  
- pyflakes                  1.6.0            py36h7bd6a15_0  
- pygame                    1.9.3                     <pip>
- pygments                  2.2.0            py36h0d3125c_0  
- pylint                    1.8.3                    py36_0  
- pyopenssl                 17.5.0           py36h20ba746_0  
- pyparsing                 2.2.0            py36hee85983_1  
- pyqt                      5.6.0            py36h0386399_5  
- pysocks                   1.6.8                    py36_0  
- python                    3.6.4                hc3d631a_3  
- python-dateutil           2.7.0                    py36_0  
- pytz                      2018.3                   py36_0  
- pyzmq                     17.0.0           py36h14c3975_0  
- qt                        5.6.2               hd25b39d_14  
- qtawesome                 0.4.4            py36h609ed8c_0  
- qtconsole                 4.3.1            py36h8f73b5b_0  
- qtpy                      1.4.0                    py36_0  
- readline                  7.0                  ha6073c6_4  
- requests                  2.18.4           py36he2e5f8d_1  
- rope                      0.10.7           py36h147e2ec_0  
- setuptools                38.5.1                   py36_0  
- simplegeneric             0.8.1                    py36_2  
- sip                       4.18.1           py36h51ed4ed_2  
- six                       1.11.0           py36h372c433_1  
- snowballstemmer           1.2.1            py36h6febd40_0  
- sphinx                    1.7.1                    py36_0  
- sphinxcontrib             1.0              py36h6d0f590_1  
- sphinxcontrib-websupport  1.0.1            py36hb5cb234_1  
- spyder                    3.2.8                    py36_0  
- sqlite                    3.22.0               h1bed415_0  
- testpath                  0.3.1            py36h8cadb63_0  
- thorpy                    1.5.9                     <pip>
- tk                        8.6.7                hc745277_3  
- tornado                   5.0                      py36_0  
- traitlets                 4.3.2            py36h674d592_0  
- typing                    3.6.4                    py36_0  
- urllib3                   1.22             py36hbe7ace6_0  
- wcwidth                   0.1.7            py36hdf4376a_0  
- webencodings              0.5.1            py36h800622e_1  
- wheel                     0.30.0           py36hfd4bba0_1  
- wrapt                     1.10.11          py36h28b7045_0  
- xz                        5.2.3                h55aa19d_2  
- zeromq                    4.2.3                h439df22_3  
- zlib                      1.2.11               ha838bed_2 

start visualization with
$ python simulation_demo.py Simulations/projCode/

## DSMAC Protocol specific notes

To run DSMAC (after configuring Castalia and its dependencies) open a terminal in "Castalia/Simulations/4203_demo" and run the following command:

	../../bin/Castalia -c DSMAC

As-is, this command will run DSMAC under an intelligent replay attack from node 5. To run DSMAC normally, a single value must be edited in "Castalia/Simulations/4203_demo/omnetpp.ini", specifically line 123 which holds the following value: 

	SN.node[5].Application.packet_rate = 100

This value indicates a higher than normal packet rate for node 5, relative to the other nodes. To get normal packet rate behaviour for node 5, change the value to equal 10. Another change that must be done to the DSMAC protocol itself to allow normal network behaviour.

The protocol itself resides in "Castalia/src/node/communication/mac/dsmac/"
For the intelligent replay attack, we hardcoded node 5's initial SID to be outdated, and we made it persistently outdated.

line 119 in DSMAC.cc should hold:

		sessionIDMap.insert(pair <int,int> (5, 90)); //outdated SID

change this value to:
		
		sessionIDMap.insert(pair <int,int> (5, 100));

to match the rest of the network.


The final change needed to enable normal network conditions is on line 419 in DSMAC.cc:

	// Special case for node 5, our malicious node
	if (SELF_MAC_ADDRESS == 5) {
		setLastLeaderSessionID(rcvPacket->getSessionIDPkt()); // latest leader id
		setSessionID(90);	
	}


change:	

	setSessionID(90);	

to the following: 

	setSessionID(getSessionID() + 1);

this will allow node 5 to update its SID normally.


Once these steps are completed, you must then run "make" in the "/Castalia/" directory, and you are then ready to run the DSMAC simulation again under normal network conditions!


To run TMAC, simply edit node 5's packet rate accordingly as seen for DSMAC in "Castalia/Simulations/4203_demo/omnetpp.ini" (abnormal node 5 for replay attack, symmetric packet rate for normal conditions) then run the following command in "Castalia/Simulations/4203_demo":

	../../bin/Castalia -c TMAC


When running these simulations (TMAC or DSMAC), you can view the results by opening the "CastaliaTrace.txt" file generated in "Castalia/Simulations/4203_demo" to see a detailed breakdown of the simulations work! We hope you enjoy!


The files in "Castalia/src/node/communication/mac/dsmac/" were developed by our team, where DSMAC specific terms such as "sessionid", "LSID", "SID", and "leadernode" can be found within. A query of these key terms will bring you to key components of DSMAC, where further understandings of our work can be found.
